<!-- public/index.html -->
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>CONSTRUCTION MODEL</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <script type="module" crossorigin src="/assets/index-CWGqjewq.js"></script>
  </head>
  <body>    
    <div id="root"></div>
    
        
    <svg width="430" height="700" style="position: absolute; top: 0; left: 0;" id="Svg"></svg>
    <script>
    // Function to detect if the user is on a mobile device
    function isMobileDevice() {
        return !!/Mobi|Android|iPhone|iPad|iPod/.test(navigator.userAgent);
    }

    const data = {
    nodes: [
        { id: "Foundation", group: 1 },
        { id: "Excavation", group: 1 },
        { id: "Concrete Pouring", group: 1 },
        { id: "Framing", group: 1 },
        { id: "Structural Work", group: 1 },
        { id: "Roofing", group: 2 },
        { id: "Plumbing", group: 2 },
        { id: "Painting", group: 2 },
        { id: "Finishing Work", group: 2 },
        { id: "Electrical Work", group: 3 },
        { id: "Flooring", group: 3 },
        { id: "Windows & Doors Installation", group: 3 },
        { id: "HVAC Installation", group: 3 }
    ],
    links: [
        { source: "Excavation", target: "Foundation", value: 1 },
        { source: "Foundation", target: "Concrete Pouring", value: 2 },
        { source: "Concrete Pouring", target: "Framing", value: 3 },
        { source: "Framing", target: "Structural Work", value: 4 },
        { source: "Roofing", target: "Plumbing", value: 5 },
        { source: "Plumbing", target: "Painting", value: 6 },
        { source: "Painting", target: "Finishing Work", value: 7 },
        { source: "Electrical Work", target: "Windows & Doors Installation", value: 8 },
        { source: "Windows & Doors Installation", target: "HVAC Installation", value: 9 },
        { source: "HVAC Installation", target: "Flooring", value: 10 }
    ]
};
      const width = 430;
      const height = 700;

      const svg = d3.select("svg")
          .attr("width", width)
          .attr("height", height);
    const simulation = d3.forceSimulation(data.nodes)
        .force("link", d3.forceLink(data.links).id(d => d.id).distance(70))
        .force("charge", d3.forceManyBody().strength(-30))
        .force("center", d3.forceCenter(width / 2, height / 2));
    
    if (!isMobileDevice()) {
      document.getElementById('Svg').style.display = 'block';
      

      const link = svg.append("g")
          .attr("class", "links")
          .selectAll("line")
          .data(data.links)
          .enter().append("line")
          .attr("class", "link")
          .attr("stroke-width", d => Math.sqrt(d.value));

      const node = svg.append("g")
          .attr("class", "nodes")
          .selectAll("circle")
          .data(data.nodes)
          .enter().append("circle")
          .attr("r", 10)
          .attr("fill", d => {
              const groupColors = { 1: "red", 2: "blue", 3: "green" };
              return groupColors[d.group] || "gray";
          })
          .call(d3.drag()
              .on("start", dragstarted)
              .on("drag", dragged)
              .on("end", dragended));

      node.append("title")
          .text(d => d.id);

      const text = svg.append("g")
          .attr("class", "labels")
          .selectAll("text")
          .data(data.nodes)
          .enter().append("text")
          .attr("dx", 12)
          .attr("dy", ".35em")
          .text(d => d.id);

      simulation
          .on("tick", () => {
              link
                  .attr("x1", d => d.source.x)
                  .attr("y1", d => d.source.y)
                  .attr("x2", d => d.target.x)
                  .attr("y2", d => d.target.y);

              node
                  .attr("cx", d => d.x = Math.max(10, Math.min(width - 10, d.x))) // Clamp x within bounds
                  .attr("cy", d => d.y = Math.max(10, Math.min(height - 10, d.y))); // Clamp y within bounds

              text
                  .attr("x", d => d.x)
                  .attr("y", d => d.y);
          });
    }else{
        document.getElementById('Svg').style.display = 'none';
    }

    function dragstarted(event, d) {
          if (!event.active) simulation.alphaTarget(0.3).restart();
          d.fx = d.x;
          d.fy = d.y;
    }

    function dragged(event, d) {
          d.fx = event.x;
          d.fy = event.y;
    }

    function dragended(event, d) {
          if (!event.active) simulation.alphaTarget(0);
          d.fx = null;
          d.fy = null;
    }
  </script>
  </body>
</html>
